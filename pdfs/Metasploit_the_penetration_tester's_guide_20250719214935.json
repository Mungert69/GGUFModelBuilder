[
  {
    "start": 1,
    "end": 9,
    "text": "METASPLOIT. Copyright © 2011 by David Kennedy, Jim O'Gorman, Devon Kearns, and Mati Aharoni\nAll rights reserved. No part of this work may be reproduced or transmitted in any form or by any means, electronic or\nmechanical, including photocopying, recording, or by any information storage or retrieval system, without the prior\nwritten permission of the copyright owner and the publisher.\n15 14 13 12 11 1 2 3 4 5 6 7 8 9\nISBN-10: 1-59327-288-X\nISBN-13: 978-1-59327-288-3\nPublisher: William Pollock\nProduction Editor: Alison Law\nCover Illustration: Hugh D’Andrade\nInterior Design: Octopod Studios\nDevelopmental Editors: William Pollock and Tyler Ortman\nTechnical Reviewer: Scott White\nCopyeditor: Lisa Theobald\nCompositors: Susan Glinert Stevens\nProofreader: Ward Webber\nIndexer: BIM Indexing & Proofreading Services\nFor information on book distributors or translations, please contact No Starch Press, Inc. directly:\nNo Starch Press, Inc.\n38 Ringold Street, San Francisco, CA 94103\nphone: 415.863.9900; fax: 415.863.9950; info@nostarch.com; www.nostarch.com\nLibrary of Congress Cataloging-in-Publication Data\nA catalog record of this book is available from the Library of Congress.\nNo Starch Press and the No Starch Press logo are registered trademarks of No Starch Press, Inc. Other product and\ncompany names mentioned herein may be the trademarks oftheir respective owners. Rather than use a trademark\nsymbol with every occurrence of a trademarked name, we areusing the names only in an editorial fashion and to the\nbenefit of the trademark owner, with no intention of infringement of the trademark.\nThe information in this book is distributed on an “As Is” basis, without warranty. While every precaution has been\ntaken in the preparation of this work, neither the author nor No Starch Press, Inc. shall have any liability to any\nperson or entity with respect to any loss or damage caused or alleged to be caused directly or indirectly by the\ninformation contained in it.\nB R I E F C O N T E N T S\nForeword by HD Moore................................................................................................xiii\nPreface.......................................................................................................................xvii\nAcknowledgments.........................................................................................................xix\nIntroduction .................................................................................................................xxi\nChapter1: The Absolute Basics of Penetration Testing.........................................................1\nChapter2: Metasploit Basics............................................................................................7\nChapter3: Intelligence Gathering...................................................................................15\nChapter4: Vulnerability Scanning...................................................................................35\nChapter5: The Joy of Exploitation...................................................................................57\nChapter6: Meterpreter..................................................................................................75\nChapter7: Avoiding Detection.......................................................................................99\nChapter8: Exploitation Using Client-Side Attacks............................................................109\nChapter9: Metasploit Auxiliary Modules.......................................................................123\nChapter10: The Social-Engineer Toolkit.........................................................................135\nChapter11: Fast-Track.................................................................................................163\nChapter12: Karmetasploit...........................................................................................177\nChapter13: Building Your Own Module........................................................................185\nChapter14: Creating Your Own Exploits.......................................................................197\nChapter15: Porting Exploits to the Metasploit Framework................................................215\nChapter16: Meterpreter Scripting.................................................................................235\nChapter17: Simulated Penetration Test..........................................................................251\nAppendixA: Configuring Your TargetMachines.............................................................267\nAppendixB: Cheat Sheet.............................................................................................275\nIndex.........................................................................................................................285\nvi Brief Contents\nC O N T E N T S I N D E T A I L\nFOREWORD by HD Moore xiii\nPREFACE xvii\nACKNOWLEDGMENTS xix\nSpecial Thanks ........................................................................................................xx\nINTRODUCTION xxi\nWhy Do A Penetration Test? ...................................................................................xxii\nWhy Metasploit? ..................................................................................................xxii\nA Brief History of Metasploit ...................................................................................xxii\nAbout this Book.....................................................................................................xxiii\nWhat’s in the Book? ..............................................................................................xxiii\nA Note on Ethics ..................................................................................................xxiv\n1\nTHE ABSOLUTE BASICS OF PENETRATION TESTING 1\nThe Phases of the PTES ..............................................................................................2\nPre-engagement Interactions .........................................................................2\nIntelligence Gathering..................................................................................2\nThreat Modeling .........................................................................................2\nVulnerability Analysis ..................................................................................3\nExploitation ................................................................................................3\nPost Exploitation ..........................................................................................3\nReporting ...................................................................................................4\nTypes of Penetration Tests ..........................................................................................4\nOvert Penetration Testing .............................................................................5\nCovert Penetration Testing ............................................................................5\nVulnerability Scanners ..............................................................................................5\nPulling It All Together ................................................................................................6\n2\nMETASPLOIT BASICS 7\nTerminology ............................................................................................................7\nExploit .......................................................................................................8\nPayload .....................................................................................................8\nShellcode ...................................................................................................8\nModule ......................................................................................................8\nListener ......................................................................................................8\nMetasploit Interfaces .................................................................................................8\nMSFconsole ................................................................................................9\nMSFcli .......................................................................................................9\nArmitage ..................................................................................................11\nMetasploit Utilities ..................................................................................................12\nMSFpayload .............................................................................................12\nMSFencode ..............................................................................................13\nNasm Shell...............................................................................................13\nMetasploit Express and Metasploit Pro ......................................................................14\nWrapping Up ........................................................................................................14\n3\nINTELLIGENCE GATHERING 15\nPassive Information Gathering .................................................................................16\nwhois Lookups ..........................................................................................16\nNetcraft ...................................................................................................17\nNSLookup ................................................................................................18\nActive Information Gathering ...................................................................................18\nPort Scanning with Nmap ..........................................................................18\nWorking with Databases in Metasploit ........................................................20\nPort Scanning with Metasploit .....................................................................25\nTargeted Scanning .................................................................................................26\nServer Message Block Scanning..................................................................26\nHunting for Poorly Configured Microsoft SQL Servers ....................................27\nSSH Server Scanning .................................................................................28\nFTP Scanning ............................................................................................29\nSimple Network Management Protocol Sweeping .........................................30\nWriting a Custom Scanner ......................................................................................31\nLooking Ahead ......................................................................................................33\n4\nVULNERABILITY SCANNING 35\nThe Basic Vulnerability Scan ....................................................................................36\nScanning with NeXpose ..........................................................................................37\nConfiguration ...........................................................................................37\nImporting Your Report into the Metasploit Framework ....................................42\nRunning NeXpose Within MSFconsole .........................................................43\nScanning with Nessus .............................................................................................44\nNessus Configuration ................................................................................44\nCreating a Nessus Scan Policy ...................................................................45\nRunning a Nessus Scan..............................................................................47\nNessus Reports .........................................................................................47\nImporting Results into the Metasploit Framework............................................48\nScanning with Nessus from Within Metasploit ..............................................49\nSpecialty Vulnerability Scanners ...............................................................................51\nValidating SMB Logins ...............................................................................51\nScanning for Open VNC Authentication.......................................................52\nScanning for Open X11 Servers ..................................................................54\nUsing Scan Results for Autopwning ...........................................................................56\n5\nTHE JOY OF EXPLOITATION 57\nBasic Exploitation ...................................................................................................58\nmsf> show exploits ....................................................................................58\nmsf> show auxiliary ..................................................................................58\nviii Contents in Detail\nmsf> show options ....................................................................................58\nmsf> show payloads ..................................................................................60\nmsf> show targets .....................................................................................62\ninfo .........................................................................................................63\nset and unset ............................................................................................63\nsetg and unsetg.........................................................................................64\nsave ........................................................................................................64\nExploiting Your First Machine ..................................................................................64\nExploiting an Ubuntu Machine .................................................................................68\nAll-Ports Payloads: Brute Forcing Ports .......................................................................71\nResource Files ........................................................................................................72\nWrapping Up ........................................................................................................73\n6\nMETERPRETER 75\nCompromising a Windows XP Virtual Machine ..........................................................76\nScanning for Ports with Nmap ....................................................................76\nAttacking MS SQL .....................................................................................76\nBrute Forcing MS SQL Server ......................................................................78\nThe xp_cmdshell........................................................................................79\nBasic Meterpreter Commands .....................................................................80\nCapturing Keystrokes .................................................................................81\nDumping Usernames and Passwords ........................................................................82\nExtracting the Password Hashes ..................................................................82\nDumping the Password Hash ......................................................................83\nPass the Hash ........................................................................................................84\nPrivilege Escalation ................................................................................................85\nToken Impersonation...............................................................................................87\nUsing ps ...............................................................................................................87\nPivoting onto Other Systems ....................................................................................89\nUsing Meterpreter Scripts ........................................................................................92\nMigrating a Process...................................................................................92\nKilling Antivirus Software ...........................................................................93\nObtaining System Password Hashes ............................................................93\nViewing All Traffic on a Target Machine ......................................................93\nScraping a System ....................................................................................93\nUsing Persistence ......................................................................................94\nLeveraging Post Exploitation Modules .......................................................................95\nUpgrading Your Command Shell to Meterpreter .........................................................95\nManipulating Windows APIs with the Railgun Add-On ................................................97\nWrapping Up ........................................................................................................97\n7\nAVOIDING DETECTION 99\nCreating Stand-Alone Binaries with MSFpayload......................................................100\nEvading Antivirus Detection ...................................................................................101\nEncoding with MSFencode .......................................................................102\nMulti-encoding ........................................................................................103\nCustom Executable Templates ................................................................................105\nLaunching a Payload Stealthily................................................................................106\nContents in Detail ix\nPackers ...............................................................................................................107\nA Final Note on Antivirus Software Evasion .............................................................108\n8\nEXPLOITATION USING CLIENT-SIDE ATTACKS 109\nBrowser-Based Exploits .........................................................................................110\nHow Browser-Based Exploits Work ............................................................111\nLooking at NOPs .....................................................................................112\nUsing Immunity Debugger to Decipher NOP Shellcode .............................................112\nExploring the Internet Explorer Aurora Exploit ..........................................................116\nFile Format Exploits ..............................................................................................119\nSending the Payload ............................................................................................120\nWrapping Up ......................................................................................................121\n9\nMETASPLOIT AUXILIARY MODULES 123\nAuxiliary Modules in Use ......................................................................................126\nAnatomy of an Auxiliary Module............................................................................128\nGoing Forward ....................................................................................................133\n10\nTHE SOCIAL-ENGINEER TOOLKIT 135\nConfiguring the Social-Engineer Toolkit ...................................................................136\nSpear-Phishing Attack Vector .................................................................................137\nWeb Attack Vectors..............................................................................................142\nJava Applet ............................................................................................142\nClient-Side Web Exploits ..........................................................................146\nUsername and Password Harvesting ..........................................................148\nTabnabbing............................................................................................150\nMan-Left-in-the-Middle ..............................................................................150\nWeb Jacking ..........................................................................................151\nPutting It All Together with a Multipronged Attack........................................153\nInfectious Media Generator ...................................................................................157\nTeensy USB HID Attack Vector ...............................................................................157\nAdditional SET Features ........................................................................................160\nLooking Ahead ....................................................................................................161\n11\nFAST-TRACK 163\nMicrosoft SQL Injection .........................................................................................164\nSQL Injector—Query String Attack.............................................................165\nSQL Injector—POST Parameter Attack........................................................166\nManual Injection .....................................................................................167\nMSSQL Bruter .........................................................................................168\nSQLPwnage............................................................................................172\nBinary-to-Hex Generator ........................................................................................174\nMass Client-Side Attack ........................................................................................175\nA Few Words About Automation............................................................................176\nx Contents in Detail\n12\nKARMETASPLOIT 177\nConfiguration ......................................................................................................178\nLaunching the Attack.............................................................................................179\nCredential Harvesting ...........................................................................................181\nGetting a Shell .....................................................................................................182\nWrapping Up ......................................................................................................184\n13\nBUILDING YOUR OWN MODULE 185\nGetting Command Execution on Microsoft SQL ........................................................186\nExploring an Existing Metasploit Module .................................................................187\nCreating a New Module .......................................................................................189\nPowerShell .............................................................................................189\nRunning the Shell Exploit ..........................................................................190\nCreating powershell_upload_exec .............................................................192\nConversion from Hex to Binary .................................................................192\nCounters ................................................................................................194\nRunning the Exploit ..................................................................................195\nThe Power of Code Reuse .....................................................................................196\n14\nCREATING YOUR OWN EXPLOITS 197\nThe Art of Fuzzing ................................................................................................198\nControlling the Structured Exception Handler ...........................................................201\nHopping Around SEH Restrictions...........................................................................204\nGetting a Return Address ......................................................................................206\nBad Characters and Remote Code Execution ...........................................................210\nWrapping Up ......................................................................................................213\n15\nPORTING EXPLOITS TO THE METASPLOIT FRAMEWORK 215\nAssembly Language Basics ....................................................................................216\nEIP and ESP Registers...............................................................................216\nThe JMP Instruction Set .............................................................................216\nNOPs and NOP Slides ............................................................................216\nPorting a Buffer Overflow ......................................................................................216\nStripping the Existing Exploit .....................................................................218\nConfiguring the Exploit Definition ..............................................................219\nTesting Our Base Exploit ..........................................................................220\nImplementing Features of the Framework ....................................................221\nAdding Randomization ............................................................................222\nRemoving the NOP Slide ..........................................................................223\nRemoving the Dummy Shellcode ................................................................223\nOur Completed Module ...........................................................................224\nSEH Overwrite Exploit ..........................................................................................226\nWrapping Up ......................................................................................................233\nContents in Detail xi\n16\nMETERPRETER SCRIPTING 235\nMeterpreter Scripting Basics ..................................................................................235\nMeterpreter API ....................................................................................................241\nPrinting Output........................................................................................241\nBase API Calls ........................................................................................242\nMeterpreter Mixins ..................................................................................242\nRules for Writing Meterpreter Scripts ......................................................................244\nCreating Your Own Meterpreter Script ....................................................................244\nWrapping Up ......................................................................................................250\n17\nSIMULATED PENETRATION TEST 251\nPre-engagement Interactions ..................................................................................252\nIntelligence Gathering...........................................................................................252\nThreat Modeling ..................................................................................................253\nExploitation .........................................................................................................255\nCustomizing MSFconsole ......................................................................................255\nPost Exploitation ...................................................................................................257\nScanning the Metasploitable System ..........................................................258\nIdentifying Vulnerable Services .................................................................259\nAttacking Apache Tomcat .....................................................................................260\nAttacking Obscure Services ...................................................................................262\nCovering Your Tracks ...........................................................................................264\nWrapping Up ......................................................................................................266\nA\nCONFIGURING YOUR TARGET MACHINES 267\nInstalling and Setting Up the System .......................................................................267\nBooting Up the Linux Virtual Machines ....................................................................268\nSetting Up a Vulnerable Windows XP Installation .....................................................269\nConfiguring Your Web Server on Windows XP ...........................................269\nBuilding a SQL Server ..............................................................................269\nCreating a Vulnerable Web Application ....................................................272\nUpdating Back|Track ..............................................................................273\nB\nCHEAT SHEET 275\nMSFconsole Commands ........................................................................................275\nMeterpreter Commands ........................................................................................277\nMSFpayload Commands .......................................................................................280\nMSFencode Commands ........................................................................................280\nMSFcli Commands ...............................................................................................281\nMSF, Ninja, Fu ....................................................................................................281\nMSFvenom ..........................................................................................................281\nMeterpreter Post Exploitation Commands ................................................................282\nINDEX 285\nxii Contents in Detail\nF O R E W O R D\nInformation technology is a complex field, littered\nwith the half-dead technology of the past and an\never-increasing menagerie of new systems, software,\nand protocols. Securing today’s enterprise networks\ninvolves more than simply patch management, fire-\nwalls, and user education; it requires frequent real-\nworld validation of what works and what fails. This is\nwhat penetration testing is all about.\nPenetration testing is a uniquely challenging job. You are paid to think\nlike a criminal, to use guerilla tactics to your advantage, and to find the weak-\nest links in a highly intricate net of defenses. The things you find can be both\nsurprising and disturbing; penetration tests have uncovered everything from\nrogue pornography sites to large-scale fraud and criminal activity.\nPenetration testing is about ignoring an organization’s perception of\nitssecurity and probing its systems for weaknesses. The data obtained from a\nsuccessful penetration test often uncovers issues that no architecture review\nor vulnerability assessment would be able to identify. Typical findings include\nshared passwords, cross-connected networks, and troves of sensitive data sit-\nting in the clear. The problems created by sloppy system administration and\nrushed implementations often pose significant threats to an organization,\nwhile the solutions languish under a dozen items on an administrator’s to-do\nlist. Penetration testing highlights these misplaced priorities and identifies\nwhat an organization needs to do to defend itself from a real intrusion.\nPenetration testers handle a company’s most sensitive resources; they\ngain access to areas that can have dire real-world consequences if the wrong\naction is taken. A single misplaced packet can bring a factory floor to a halt,\nwith a cost measured in millions of dollars per hour. Failure to notify the\nappropriate personnel can result in an uncomfortable and embarrassing con-\nversation with the local police. Medical systems are one area that even the\nmost experienced security professionals may hesitate to test; nobody wants\ntobe responsible for mixing up a patient’s blood type in an OpenVMS main-\nframe or corrupting the memory on an X-ray machine running Windows XP.\nThe most critical systems are often the most exposed, and few system admin-\nistrators want to risk an outage by bringing down a database server to apply a\nsecurity patch.\nBalancing the use of available attack paths and the risk of causing dam-\nage is a skill that all penetration testers must hone. This process depends not\nonly on a technical knowledge of the tools and the techniques but also on a\nstrong understanding of how the organization operates and where the path\nof least resistance may lie.\nIn this book, you will see penetration testing through the eyes of four\nsecurity professionals with widely divergent backgrounds. The authors include\nfolks with experience at the top of the corporate security structure all the way\ndown to the Wild West world of underground exploit development and vulner-\nability research. There are a number of books available on penetration test-\ning and security assessments, and there are many that focus entirely on tools.\nThis book, however, strives for a balance between the two, covering the fun-\ndamental tools and techniques while also explaining how they play into the\noverall structure of a successful penetration testing process. Experienced\npenetration testers will benefit from the discussion of the methodology,\nwhich is based on the recently codified Penetration Test Execution Standard.\nReaders who are new to the field will be presented with a wealth of informa-\ntion not only about how to get started but also why those steps matter and\nwhat they mean in the bigger picture.\nThis book focuses on the Metasploit Framework. This open source\nplatform provides a consistent, reliable library of constantly updated exploits\nand offers a complete development environment for building new tools and\nautomating every aspect of a penetration test. Metasploit Express and Meta-\nsploit Pro, the commercial siblings of the Framework, are also represented in\nthis book. These products provide a different perspective on how to conduct\nand automate large-scale penetration tests.\nxiv Foreword\nThe Metasploit Framework is an infamously volatile project; the code\nbase is updated dozens of times every day by a core group of developers and\nsubmissions from hundreds of community contributors. Writing a book about\nthe Framework is a masochistic endeavor; by the time that a given chapter\nhas been proofread, the content may already be out of date. The authors\ntook on the Herculean task of writing this book in such a way that the con-\ntent will still be applicable by the time it reaches its readers.\nThe Metasploit team has been involved with this book to make sure that\nchanges to the code are accurately reflected and that the final result is as close\nto zero-day coverage of the Metasploit Framework as is humanly possible. We\ncan state with full confidence that it is the best guide to the Metasploit Frame-\nwork available today, and it will likely remain so for a long time. We hope you\nfind this book valuable in your work and an excellent reference in your trials\nahead.\nHD Moore\nFounder, The Metasploit Project\nForeword xv\nP R E F A C E\nThe Metasploit Framework has long been one of the\ntools most widely used by information security pro-\nfessionals, but for a long time little documentation\nexisted aside from the source code itself or comments\non blogs. That situation changed significantly when\nOffensive-Security developed its online course, Meta-\nsploit Unleashed. Shortly after the course went live, No\nStarch Press contacted us about the possibly of creat-\ning a book to expand on our work with Metasploit\nUnleashed.\nThis book is designed to teach you the ins and outs of Metasploit and\nhow to use the Framework to its fullest. Our coverage is selective—we won’t\ncover every single flag or exploit—but we give you the foundation you’ll need\nto understand and use Metasploit now and in future versions.\nWhen we began writing this book, we had in mind a comment by HD\nMoore, developer of the Metasploit Framework. In a conversation with HD\nabout the development of our Metasploit Unleashed course, one of us said\ntohim, “I hope the course comes out good.” To this offhand comment, HD\nmerely replied, “Then make sure it is good.” And that’s just what we’ve\nattempted to do with this book.\nAs a group, we are experienced penetration testers who use Metasploit\ndaily to circumvent security controls, bypass protections, and attack systems\nmethodically. We wrote this book with the intention of helping our readers\nbecome competent penetration testers. HD’s drive and focus on quality is\napparent within the Metasploit Framework, and we have tried to match those\ncharacteristics in this book. We leave it up to you to judge how well we have\nlived up to that standard.\nxviii Preface\nA C K N O W L E D G M E N T S\nWe would like to thank a number of people, begin-\nning with the folks whose hard work provides the\ncommunity with an invaluable tool. Special thanks to\nthe Metasploit Team: HD Moore, James Lee, David\nD. Rude II, Tod Beardsley, Jonathan Cran, Stephen\nFewer, Joshua Drake, Mario Ceballos, Ramon Valle,\nPatrick Webster, Efrain Torres, Alexandre Maloteaux, Wei Chen, Steve Tornio,\nNathan Keltner, Chris Gates, Carlos Perez, Matt Weeks, and Raphael Mudge.\nAlso an extra thanks to Carlos Perez for his assistance inwriting portions of\nthe Meterpreter scripting chapter.\nMany thanks to Scott White, technical reviewer for this book, for being\nawesome.\nThanks to Offensive-Security for bringing us all together. The Offensive-\nSecurity trademark phrase “Try Harder” alternately inspires and tortures us\n(ryujin is evil).\nWe have many other members of the information security community\ntothank, but there are too many to list and the odds of missing someone are\nhigh. So thank you to our friends in the security community; hugs from all\nofus.\nA very special thanks to the whole crew at No Starch Press for their\nimmeasurable effort. Bill, Alison, Travis, and Tyler, it has been a pleasure\nworking with you and everyone else behind the scenes at No Starch Press!\nFinally, a big thank you to our families. We are all married and half of\nushave children. We spend far too long wearing down the plastic on our\nkeyboards and not enough time with them. To our families, thanks for your\nunderstanding; we will make it up to you—as soon as we update this next\nlineof code, or find the source of this memory corruption, or finish this svn\nupdate, or get this next fuzzer run setup, or . . .\nSpecial Thanks\nDave (Twitter: @dave_rel1k): I dedicate my work on this book to my loving\nwife Erin, who tolerated late nights of me hammering away at the keyboard.\nTo my three children who keep me young and old at the same time. To my\nfather, Jim; my mother, Janna; and my stepmother, Deb, for being there for\nme and making me what I am today. Thanks to Jim, Dookie, and Muts for\ntheir hard work on the book and for being great friends! To my good friends\nat Offensive-Security; Chris “Logan” Hadnagy; my brother, Shawn Sullivan;\nand my team at Diebold. To my good friend HD Moore, whose dedication to\nthe security industry is an inspiration to us all. To all my friends in life, and to\nScott Angelo for giving me an opportunity and believing in me. Lastly, to\nGod, without whom none of this would be possible.\nDevon (@dookie2000ca): For my beautiful and tolerant wife, who not\nonly supports but encourages my mania. You are my inspiration and motiva-\ntion; without you by my side in these pursuits, I would never get anywhere.\nTo my co-authors, thank you for having faith in a newcomer and welcoming\nme as one of your own. Lastly, an especially big thank you to Mati for not\nonly getting this merry band together but for giving me a chance.\nMuts (@backtracklinux): A special thanks to the co-authors of this book,\nwhose time and dedication to it is truly inspiring. I count Jim, Devon, and\nDave as great friends and colleagues in the security field.\nJim (@_Elwood_): Thanks to Matteo, Chris “Logan,” and the entire\nOffensive-Security crew. Also a big thanks to Robert, Matt, Chris, and my\nco-workers at StrikeForce. And to my wonderful wife Melissa: The book you\nhold in your hands is proof that I was not just avoiding housework all the time.\nAnd to Jake and Joe, please don’t tell Mom that I am just playing games with\nyou when I tell her I am working. You three are the Pack-a-Punch to my life.\nAnd finally to my co-authors Mati, Devon, and Dave: Thanks for letting me\nput my name on this book—I really was just avoiding housework.\nxx Acknowledgments\nI N T R O D U C T I O N\nImagine that sometime in the not-so-distant future an\nattacker decides to attack a multinational company’s\ndigital assets, targeting hundreds of millions of dollars\nworth of intellectual property buried behind millions\nof dollars in infrastructure. Naturally, the attacker\nbegins by firing up the latest version of Metasploit.\nAfter exploring the target’s perimeter, he finds a soft spot and begins a\nmethodical series of attacks, but even after he’s compromised nearly every\naspect of the network, the fun has only just begun. He maneuvers through\nsystems, identifying core, critical business components that keep the com-\npany running. With a single keystroke, he could help himself to millions of\ncompany dollars and compromise all their sensitive data.\nCongratulations on a job well done—you’ve shown true business impact,\nand now it’s time to write the report. Oddly enough, today’s penetration\ntesters often find themselves in the role of a fictitious adversary like the one\ndescribed above, performing legal attacks at the request of companies that\nneed high levels of security. Welcome to the world of penetration testing and\nthe future of security.\nWhy Do a Penetration Test?\nCompanies invest millions of dollars in security programs to protect critical\ninfrastructures, identify chinks in the armor, and prevent serious data breaches.\nA penetration test is one of the most effective ways to identify systemic weak-\nnesses and deficiencies in these programs. By attempting to circumvent secu-\nrity controls and bypass security mechanisms, a penetration tester is able to\nidentify ways in which a hacker might be able to compromise an organization’s\nsecurity and damage the organization as a whole.\nAs you read through this book, remember that you’re not necessarily\ntargeting one system or multiple systems. Your goal is to show, in a safe and\ncontrolled manner, how an attacker might be able to cause serious harm to\nan organization and impact its ability to, among other things, generate reve-\nnue, maintain its reputation, and protect its customers.\nWhy Metasploit?\nMetasploit isn’t just a tool; it’s an entire framework that provides the infra-\nstructure needed to automate mundane, routine, and complex tasks. This\nallows you to concentrate on the unique or specialized aspects of penetration\ntesting and on identifying flaws within your information security program.\nAs you progress through the chapters in this book and establish a well-\nrounded methodology, you will begin to see the many ways in which Meta-\nsploit can be used in your penetration tests. Metasploit allows you to easily\nbuild attack vectors to augment its exploits, payloads, encoders, and more\ninorder to create and execute more advanced attacks. At various points in\nthis book we explain several third-party tools—including some written by the\nauthors of this book—that build on the Metasploit Framework. Our goal is to\nget you comfortable with the Framework, show you some advanced attacks,\nand ensure that you can apply these techniques responsibly. We hope you\nenjoy reading this book as much as we enjoyed creating it. Let the fun and\ngames begin.\nA Brief History of Metasploit\nMetasploit was originally developed and conceived by HD Moore while he\nwas employed by a security firm. When HD realized that he was spending\nmost of his time validating and sanitizing public exploit code, he began to\ncreate a flexible and maintainable framework for the creation and develop-\nment of exploits. He released his first edition of the Perl-based Metasploit\ninOctober 2003 with a total of 11 exploits.\nWith the help of Spoonm, HD released a total rewrite of the project,\nMetasploit 2.0, in April 2004. This version included 19 exploits and over 27\npayloads. Shortly after this release, Matt Miller (Skape) joined the Metasploit\ndevelopment team, and as the project gained popularity, the Metasploit Frame-\nwork received heavy backing from the information security community and\nquickly became a necessary tool for penetration testing and exploitation.\nxxii Introduction\nFollowing a complete rewrite in the Ruby programming language,\ntheMetasploit team released Metasploit 3.0 in 2007. The migration of the\nFramework from Perl to Ruby took 18 months and resulted in over 150,000\nlines of new code. With the 3.0 release, Metasploit saw widespread adoption\nin the security community and a big increase in user contributions.\nIn fall 2009, Metasploit was acquired by Rapid7, a leader in the\nvulnerability-scanning field, which allowed HD to build a team to focus\nsolelyon the development of the Metasploit Framework. Since the acquisi-\ntion, updates have occurred more rapidly than anyone could have imagined.\nRapid7 released two commercial products based on the Metasploit Frame-\nwork: Metasploit Express and Metasploit Pro. Metasploit Express is a lighter\nversion of the Metasploit Framework with a GUI and additional functionality,\nincluding reporting, among other useful features. Metasploit Pro is an expanded\nversion of Metasploit Express that touts collaboration and group penetration\ntesting and such features as a one-click virtual private network (VPN) tunnel\nand much more.\nAbout This Book\nThis book is designed to teach you everything from the fundamentals of\ntheFramework to advanced techniques in exploitation. Our goal is to pro-\nvide a useful tutorial for the beginner and a reference for practitioners. How-\never, we won’t always hold your hand. Programming knowledge is a definite\nadvantage in the penetration testing field, and many of the examples in this\nbook will use either the Ruby or Python programming language. Still, while\nwe suggest that you learn a language like Ruby or Python to aid in advanced\nexploitation and customization of attacks, programming knowledge is not\nrequired.\nAs you grow more comfortable with Metasploit, you will notice that the\nFramework is frequently updated with new features, exploits, and attacks.\nThis book was developed with the knowledge that Metasploit is continually\nchanging and that no printed book is likely to be able to keep pace with this\nrapid development. Therefore, we focus on the fundamentals, because once\nyou understand how Metasploit works you will be able to ramp up quickly\nwith updates to the Framework.\nWhat’s in the Book?\nHow can this book help you to get started or take your skills to the next level?\nEach chapter is designed to build on the previous one and to help you build\nyour skills as a penetration tester from the ground up.\n(cid:122) Chapter 1, “The Absolute Basics of Penetration Testing,” establishes the\nmethodologies around penetration testing.\n(cid:122) Chapter 2, “Metasploit Basics,” is your introduction to the various tools\nwithin the Metasploit Framework.\n(cid:122) Chapter 3, “Intelligence Gathering,” shows you ways to leverage Meta-\nsploit in the reconnaissance phase of a penetration test.\nIntroduction xxiii\n(cid:122) Chapter 4, “Vulnerability Scanning,” walks you through identifying vul-\nnerabilities and leveraging vulnerability scanning technology.\n(cid:122) Chapter 5, “The Joy of Exploitation,” throws you into exploitation.\n(cid:122) Chapter 6, “Meterpreter,” walks you through the Swiss Army knife of\npost exploitation: Meterpreter.\n(cid:122) Chapter 7, “Avoiding Detection,” focuses on the underlying concepts of\nantivirus evasion techniques.\n(cid:122) Chapter 8, “Exploitation Using Client-Side Attacks,” covers client-side\nexploitation and browser bugs.\n(cid:122) Chapter 9, “Metasploit Auxiliary Modules,” walks you through auxiliary\nmodules.\n(cid:122) Chapter 10, “The Social-Engineer Toolkit,” is your guide to leveraging\nthe Social-Engineer Toolkit in social-engineering attacks.\n(cid:122) Chapter 11, “Fast-Track,” offers a complete run down on Fast-Track, an\nautomated penetration testing framework.\n(cid:122) Chapter 12, “Karmetasploit,” shows you how to leverage Karmetasploit\nfor wireless attacks.\n(cid:122) Chapter 13, “Building Your Own Modules,” teaches you how to build\nyour own exploitation module.\n(cid:122) Chapter 14, “Creating Your Own Exploits,” covers fuzzing and creating\nexploit modules out of buffer overflows.\n(cid:122) Chapter 15, “Porting Exploits to the Metasploit Framework,” is an in-\ndepth look at how to port existing exploits into a Metasploit-based module.\n(cid:122) Chapter 16, “Meterpreter Scripting,” shows you how to create your own\nMeterpreter scripts.\n(cid:122) Chapter 17, “Simulated Penetration Test,” pulls everything together as it\nwalks you through a simulated penetration test.\nA Note on Ethics\nOur goal in writing this book is to help you to improve your skills as a pene-\ntration tester. As a penetration tester, you will be bypassing security measures;\nthat’s simply part of the job. When you do, keep the following in mind:\n(cid:122) Don’t be malicious.\n(cid:122) Don’t be stupid.\n(cid:122) Don’t attack targets without written permission.\n(cid:122) Consider the consequences of your actions.\n(cid:122) If you do things illegally, you can be caught and put in jail!\nNeither the authors of this book nor No Starch Press, its publisher,\ncondones or encourages the misuse of the penetration testing techniques\ndiscussed herein. Our goal is to make you smarter, not to help you to get\nintotrouble, because we won’t be there to get you out.\nxxiv Introduction",
    "question": "What is the main focus and purpose of the book \"Metasploit\" by David Kennedy, Jim O'Gorman, Devon Kearns, and Mati Aharoni?",
    "summary": "This book provides a comprehensive guide to the Metasploit Framework, covering its basics, advanced techniques, and various tools used in penetration testing. It explains how to conduct penetration tests, including intelligence gathering, vulnerability scanning, and exploitation, while emphasizing the importance of ethical use. The authors, with diverse backgrounds in security, aim to equip readers with the knowledge and skills needed to perform effective and responsible penetration testing."
  }
]